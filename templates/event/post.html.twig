{% extends 'base.html.twig' %}

{% block title %}Add Message To {{ event.name }}{% endblock %}

{% block navbar %}
{% endblock %}
        
{% block body %}
{% if event.style %}
    <style>
    	#live-venue-title {
            {% if event.style.headerBackgroundColor %}background-color: {{ event.style.headerBackgroundColor }};{% endif %}
            {% if event.style.headerTextColor %}color: {{ event.style.headerTextColor }};{% endif %}
        }
        {% if event.style.linkColor %}a { color: {{ event.style.linkColor }};}{% endif %}
        {% if event.style.majorInfoColor %}.info-major { color: {{ event.style.majorInfoColor }}; border-color: {{ event.style.majorInfoColor }};}{% endif %}	
    </style>
{% endif %}

<div class="main-wrapper">
    <div id="post-message" class="container">
        <div id="live-venue-title">
        	{% if event.style and event.style.untappdLogoStyle %}
        		{% set untappdLogo = 'untappd_' ~ event.style.untappdLogoStyle %}
        	{% else %}
        		{% set untappdLogo = 'untappd_black' %}
        	{% endif %}
            <div class="description">
            	{% if event.eventLogo %}
            		<img src="{{ asset("images/events/") ~ event.eventLogo }}" />
            	{% else %}
    				{{ event.name }}
            	{% endif %}
            </div>
        </div>
        
    	<span class="page-title info-major">Submit a new message</span>
    	{% if not success %}
    		<p>Authenticated as {{ publisher.name }}. Remaining messages: {{ publisher.remainingMessages }}.<br />
    		<a href="{{ path('post_logout', { 'eventID': event.id }) }}">Logout</a><p>
        	<p>This form will allow you to send a message to the "{{ event.name }}" live beer feed. Please remind that this message will be public and be broadcasted to subscribed visitors.<br />
        	You can use it to make important announcements (plugging a new keg, ...). You can only post a message every 2 hours and the amount of messages you can post during the event is limited.<br />
        	Please fill the 3 message lines and select the time when it should begin to be broadcasted. Highlighted lines will display in a <span class="info-major">different color</span>.<br />
        	Your message will last for 10 minutes after the start date.<br />
        	<b class="info-major">This functionnality must not be shared with visitors.</b></p>
        	{% if publisher.lastPublicationDate is not null AND publisher.getMinutesSinceLastPublication < 120 %}
    			<p>Your last message was submited less than 2 hours ago.<br />
    			You'll be allowed to send a new message at {{ publisher.lastPublicationDate|date_modify("+2 hours")|date("H:i:s") }}.</p>
        	{% elseif publisher.remainingMessages <= 0 %}
    			<p>You have reached your messages limit and can no longer send a new one.</p>
        	{% else %}
            	{% if "now"|date('Y-m-d H:i:s') < event.startDate|date('Y-m-d H:i:s') %}
            		<div id="event-upcoming">
                    	<div class="alert alert-primary" role="alert">
                    		<div class="large-icon">
                    			<i class="fa fa-clock-o" aria-hidden="true"></i>
                    		</div>
                			<b>You're too early!</b></br>
                		    {{ event.name }} hasn't started yet. However, you can already subscribe to receive upcoming notifications!</br>
                			This event will start <span id="time-left-event" data-date="{{ event.startDate|date("D, d M Y H:i:s O") }}"></span>. This page will automatically refresh.
                   		 </div>
            		</div>
          		{% else %}
                	<div class="card card-block bg-faded">
                		<div class="card-body">
                            {{ form_start(form) }}
                            <div class="form-group">
                                {{ form_label(form.message_line_1) }}
            					<div class="form-highlight info-major">{{ form_label(form.message_line_1_important) }} {{ form_widget(form.message_line_1_important) }}</div>
                                {{ form_errors(form.message_line_1) }}
                                {{ form_widget(form.message_line_1) }}
                            </div>
                            <div class="form-group">
                                {{ form_label(form.message_line_2) }}
            					<div class="form-highlight info-major">{{ form_label(form.message_line_2_important) }} {{ form_widget(form.message_line_2_important) }}</div>
                                {{ form_errors(form.message_line_2) }}
                                {{ form_widget(form.message_line_2) }}
                            </div>
                            <div class="form-group">
                                {{ form_label(form.message_line_3) }}
            					<div class="form-highlight info-major">{{ form_label(form.message_line_3_important) }} {{ form_widget(form.message_line_3_important) }}</div>
                                {{ form_errors(form.message_line_3) }}
                                {{ form_widget(form.message_line_3) }}
                            </div>
                            {{ form_widget(form) }}
                            {{ form_end(form) }}
                        </div>
            		</div>
            	{% endif %}
        	{% endif %}
    	{% else %}
    		<p>Your message has successfully been registered. Thanks!</p>
    	{% endif %}	
    </div>
    
</div>

<script>
	var minTime = "{{ "now"|date('H:i') }}"
</script>

{% endblock %}
